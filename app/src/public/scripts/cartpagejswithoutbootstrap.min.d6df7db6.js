!function($){"use strict";var partner,userId,OptionManager=function(){var objToReturn={},defaultOptions={partner:"local",userId:"0",currencySymbol:"$",classCartIcon:"my-cart-icon",classCartBadge:"my-cart-badge",classProductQuantity:"my-product-quantity",classProductRemove:"my-product-remove",classCheckoutCart:"my-cart-checkout",affixCartIcon:!0,showCheckoutModal:!0,cartItems:[],clickOnAddToCart:function($addTocart){},clickOnRemoveFromCart:function($addTocart){},afterAddOnCart:function(products,totalPrice,totalQuantity){},clickOnCartIcon:function($cartIcon,products,totalPrice,totalQuantity){},checkoutCart:function(products,totalPrice,totalQuantity){},getDiscountPrice:function(products,totalPrice,totalQuantity){return null}},getOptions=function(customOptions){var options=$.extend({},defaultOptions);return"object"==typeof customOptions&&$.extend(options,customOptions),options.partner&&(partner=options.partner),options.userId&&(userId=options.userId),options};return objToReturn.getOptions=getOptions,objToReturn}(),ProductManager=function(){var objToReturn={};localStorage.products=localStorage.products?localStorage.products:{};var getIndexOfProduct=function(id){var productIndex=-1,products=getAllProducts();return $.each(products,function(index,value){return value.id==id?void(productIndex=index):void 0}),productIndex},setAllProducts=function(products){var o={};o[partner]||(o[partner]={}),o[partner][userId]=products,localStorage.products=JSON.stringify(o)},addProduct=function(id,name,summary,price,quantity,image,type,maxQuantity,groupName){var products=getAllProducts();products.push({id:id,name:name,summary:summary,price:price,quantity:quantity,image:image,maxQuantity:maxQuantity,groupName:groupName}),setAllProducts(products)},getAllProducts=function(){try{var products=JSON.parse(localStorage.products);return userId&&products[partner]&&products[partner][userId]?products[partner][userId]:[]}catch(e){return[]}},updatePoduct=function(id,quantity){var productIndex=getIndexOfProduct(id);if(0>productIndex)return!1;var products=getAllProducts();return products[productIndex].quantity="undefined"==typeof quantity?1*products[productIndex].quantity+1:quantity,setAllProducts(products),!0},setProduct=function(id,name,summary,price,quantity,image,type,maxQuantity,groupName){return"undefined"==typeof id?(console.error("id required"),!1):"undefined"==typeof name?(console.error("name required"),!1):"undefined"==typeof image?(console.error("image required"),!1):$.isNumeric(price)?$.isNumeric(quantity)?(summary="undefined"==typeof summary?"":summary,void(updatePoduct(id)||addProduct(id,name,summary,price,quantity,image,type,maxQuantity,groupName))):(console.error("quantity is not a number"),!1):(console.error("price is not a number"),!1)},clearProduct=function(){setAllProducts([])},removeProduct=function(id){var products=getAllProducts();products=$.grep(products,function(value,index){return value.id!=id}),setAllProducts(products)},getTotalQuantity=function(){var total=0,products=getAllProducts();return $.each(products,function(index,value){total+=1*value.quantity}),total},getTotalPrice=function(){var products=getAllProducts(),total=0;return $.each(products,function(index,value){total+=value.quantity*value.price}),total};return objToReturn.getAllProducts=getAllProducts,objToReturn.updatePoduct=updatePoduct,objToReturn.setProduct=setProduct,objToReturn.clearProduct=clearProduct,objToReturn.removeProduct=removeProduct,objToReturn.getTotalQuantity=getTotalQuantity,objToReturn.getTotalPrice=getTotalPrice,objToReturn}(),loadMyCartEvent=function(userOptions){var options=OptionManager.getOptions(userOptions),$cartIcon=$("."+options.classCartIcon),$cartBadge=$("."+options.classCartBadge),classProductQuantity=options.classProductQuantity,classProductRemove=options.classProductRemove,classCheckoutCart=options.classCheckoutCart,idCartModal="my-cart-modal",idCartTable="my-cart-table",idGrandTotal="my-cart-grand-total",idEmptyCartMessage="my-cart-empty-message",idDiscountPrice="my-cart-discount-price",classProductTotal="my-product-total",classAffixMyCartIcon="my-cart-icon-affix";userOptions.cartItems&&userOptions.cartItems.constructor===Array&&(ProductManager.clearProduct(),$.each(options.cartItems,function(){ProductManager.setProduct(this.id,this.name,this.summary,this.price,this.quantity,this.image,this.type,this.maxQuantity,this.groupName)})),$cartBadge.text(ProductManager.getTotalQuantity()),$("#"+idCartModal).length||$("body").append('<div class="modal fade" id="'+idCartModal+'" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel"><span class="glyphicon glyphicon-shopping-cart"></span> My Cart</h4></div><div class="modal-body"><table class="table table-hover table-responsive" id="'+idCartTable+'"></table></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button><button type="button" class="btn btn-primary '+classCheckoutCart+'">Checkout</button></div></div></div></div>');var drawTable=function(){var $cartTable=$("#"+idCartTable);$cartTable.empty();var products=ProductManager.getAllProducts();$.each(products,function(){var total=this.quantity*this.price;$cartTable.append('<tr title="'+this.summary+'" data-id="'+this.id+'" data-price="'+this.price+'"><td class="text-center" style="width: 150px;"><img width="100%" height="auto" src="'+this.image+'"/></td><td>'+this.name+"</td>"+(this.maxQuantity>1?'<td title="Unit Price">'+options.currencySymbol+this.price+'</td><td title="Quantity"><input type="number" min="1" max="'+this.maxQuantity+'" style="width: 70px;" class="'+classProductQuantity+'" value="'+this.quantity+'"/></td>':'<td title="Unit Price">'+options.currencySymbol+this.price+'</td><td title="Quantity"><input type="number" min="1" max="'+this.maxQuantity+'" style="width: 70px;" class="'+classProductQuantity+'" value="'+this.quantity+'"/></td>')+'<td title="Total" class="'+classProductTotal+'">'+options.currencySymbol+total+'</td><td title="Remove from Cart" class="text-center" style="width: 30px;"><a href="javascript:void(0);" class="btn btn-xs btn-danger '+classProductRemove+'">X</a></td></tr>')}),$cartTable.append(products.length?'<tr><td></td><td><strong>Total</strong></td><td></td><td></td><td><strong id="'+idGrandTotal+'"></strong></td><td></td></tr>':'<div class="alert alert-danger" role="alert" id="'+idEmptyCartMessage+'">Your cart is empty</div>');var discountPrice=options.getDiscountPrice(products,ProductManager.getTotalPrice(),ProductManager.getTotalQuantity());products.length&&null!==discountPrice&&$cartTable.append('<tr style="color: red"><td></td><td><strong>Total (including discount)</strong></td><td></td><td></td><td><strong id="'+idDiscountPrice+'"></strong></td><td></td></tr>'),showGrandTotal(),showDiscountPrice()},showModal=function(){drawTable(),$("#"+idCartModal).modal("show")},updateCart=function(){$.each($("."+classProductQuantity),function(){var id=$(this).closest("tr").data("id");ProductManager.updatePoduct(id,$(this).val())})},showGrandTotal=function(){$("#"+idGrandTotal).text(options.currencySymbol+ProductManager.getTotalPrice())},showDiscountPrice=function(){$("#"+idDiscountPrice).text(options.currencySymbol+options.getDiscountPrice(ProductManager.getAllProducts(),ProductManager.getTotalPrice(),ProductManager.getTotalQuantity()))};if(options.affixCartIcon){var cartIconBottom=1*$cartIcon.offset().top+1*$cartIcon.css("height").match(/\d+/);$cartIcon.css("position");$(window).scroll(function(){$(window).scrollTop()>=cartIconBottom?$cartIcon.addClass(classAffixMyCartIcon):$cartIcon.removeClass(classAffixMyCartIcon)})}$cartIcon.click(function(){options.showCheckoutModal?showModal():options.clickOnCartIcon($cartIcon,ProductManager.getAllProducts(),ProductManager.getTotalPrice(),ProductManager.getTotalQuantity())}),$(document).on("input","."+classProductQuantity,function(){var price=$(this).closest("tr").data("price"),id=$(this).closest("tr").data("id"),quantity=$(this).val();$(this).parent("td").next("."+classProductTotal).text("$"+price*quantity),ProductManager.updatePoduct(id,quantity),$cartBadge.text(ProductManager.getTotalQuantity()),showGrandTotal(),showDiscountPrice()}),$(document).on("keypress","."+classProductQuantity,function(evt){38!=evt.keyCode&&40!=evt.keyCode&&evt.preventDefault()}),$(document).on("click","."+classProductRemove,function(){var $tr=$(this).closest("tr"),id=$tr.data("id");$tr.hide(500,function(){ProductManager.removeProduct(id),drawTable(),$cartBadge.text(ProductManager.getTotalQuantity())})}),$("."+classCheckoutCart).click(function(){var products=ProductManager.getAllProducts();return products.length?(updateCart(),options.checkoutCart(ProductManager.getAllProducts(),ProductManager.getTotalPrice(),ProductManager.getTotalQuantity()),$cartBadge.text(ProductManager.getTotalQuantity()),void $("#"+idCartModal).modal("hide")):void $("#"+idEmptyCartMessage).fadeTo("fast",.5).fadeTo("fast",1)})},MyCart=function(target,userOptions){var $target=$(target),options=OptionManager.getOptions(userOptions),$cartBadge=($("."+options.classCartIcon),$("."+options.classCartBadge));$target.click(function(){options.clickOnAddToCart($target);var id=$target.data("id"),name=$target.data("name"),summary=$target.data("summary"),price=$target.data("price"),quantity=$target.data("quantity"),maxQuantity=$target.data("max-quantity"),image=$target.data("image"),type=$target.data("type"),groupName=$target.data("group"),isRemove=$target.find(".btn-add").hasClass("is-remove");isRemove?(ProductManager.removeProduct(id),$cartBadge.text(ProductManager.getTotalQuantity()),options.clickOnRemoveFromCart(ProductManager.getAllProducts(),ProductManager.getTotalPrice(),ProductManager.getTotalQuantity()),$target.find(".btn-add").removeClass("is-remove").html("Add"),$target.removeClass("in-cart")):(ProductManager.setProduct(id,name,summary,price,quantity,image,type,maxQuantity,groupName),$cartBadge.text(ProductManager.getTotalQuantity()),options.afterAddOnCart(ProductManager.getAllProducts(),ProductManager.getTotalPrice(),ProductManager.getTotalQuantity()),1==maxQuantity&&($target.addClass("in-cart"),$target.find(".btn-add").addClass("is-remove").html("Remove")))})};$.fn.myCart=function(userOptions){return loadMyCartEvent(userOptions),$.each(this,function(){new MyCart(this,userOptions)})}}(jQuery),function(){function profilePageBinding(){$(".form").find("input, textarea").on("keyup blur focus",function(e){var $this=$(this),label=$this.prev("label");"keyup"===e.type?""===$this.val()?label.removeClass("active highlight"):label.addClass("active highlight"):"blur"===e.type?""===$this.val()?label.removeClass("active highlight"):label.removeClass("highlight"):"focus"===e.type&&(""===$this.val()?label.removeClass("highlight"):""!==$this.val()&&label.addClass("highlight"))}),$(".tab a").on("click",function(e){e.preventDefault(),$(this).parent().addClass("active"),$(this).parent().siblings().removeClass("active"),target=$(this).attr("href"),$(".tab-content > div").not(target).hide(),$(target).fadeIn(600)})}function setupCart(){var isCartPage=$("#cartpage");if(isCartPage.length){var goToCartIcon=function($addTocartBtn){var $cartIcon=$(".my-cart-icon"),$image=$('<img width="30px" height="30px" src="'+$addTocartBtn.data("image")+'"/>').css({position:"fixed","z-index":"999"});$addTocartBtn.prepend($image);var position=$cartIcon.position();$image.animate({top:position.top,left:position.left},500,"linear",function(){$image.remove()})};planId=$("#cartpage").attr("data-planid"),$(".my-cart-wrapper-row").myCart({partner:partner,userId:userId,currencySymbol:"₹",classCartIcon:"my-cart-icon",classCartBadge:"my-cart-badge",classProductQuantity:"my-product-quantity",classProductRemove:"my-product-remove",classCheckoutCart:"my-cart-checkout",affixCartIcon:!0,showCheckoutModal:!0,clickOnAddToCart:function($addTocart){goToCartIcon($addTocart)},afterAddOnCart:function(products,totalPrice,totalQuantity){console.log("afterAddOnCart",products,totalPrice,totalQuantity)},clickOnCartIcon:function($cartIcon,products,totalPrice,totalQuantity){console.log("cart icon clicked",$cartIcon,products,totalPrice,totalQuantity)},checkoutCart:function(products,totalPrice,totalQuantity){var checkoutString="Total Price: "+totalPrice+"\\nTotal Quantity: "+totalQuantity;checkoutString+="\\n\n id 	 name 	 summary 	 price 	 quantity 	 image path",$.each(products,function(){checkoutString+="\\n "+this.id+" 	 "+this.name+" 	 "+this.summary+" 	 "+this.price+" 	 "+this.quantity+" 	 "+this.image}),checkoutCart(products,totalPrice,totalQuantity)},getDiscountPrice:function(products,totalPrice,totalQuantity){return console.log("calculating discount",products,totalPrice,totalQuantity),totalPrice}});var updateCurrentViewFromCartItems=function(){for(var items=getAllProducts(),viewItems=$(".my-cart-btn"),inCart=function(id){for(var i=0;i<items.length;i++)if(items[i].id==id)return!0;return!1},i=0;i<viewItems.length;i++){var $e=$(viewItems[i]),id=$e.attr("data-id"),isInCart=inCart(id);isInCart?($e.addClass("is-remove").html("Remove"),$e.closest(".my-cart-wrapper-row").addClass("in-cart")):($e.removeClass("is-remove").html("Add"),$e.closest(".my-cart-wrapper-row").removeClass("in-cart"))}};updateCurrentViewFromCartItems()}}function getpaymentData(){var $active=$(".tab-pane.active"),type=$active.data("type"),data={},couponCode=$("#coupon_code").val();if(couponCode&&(data.coupon_code=couponCode),"1"==type);else if("2"==type){var referralCode=$active.find("#agent_id").val();referralCode&&(data.agentCode=referralCode);var address=$active.find("#payment_address").val(),prefferedTime1=$active.find("#time_from").val(),prefferedTime2=$active.find("#time_to").val();data.message="Please provide cach/cheque collection facility to my address: \n "+address+"\n My Preferred Time is between "+(prefferedTime1+" to "+prefferedTime2),data.mode="REQUEST_CASH"}else if("3"==type){var referralCode=$active.find("#agent_id").val();referralCode&&(data.agentCode=referralCode);var otp=$active.find("#agent_otp").val();otp&&(data.otp=otp),data.mode="CASH"}else if("4"==type){var referralCode=$active.find("#agent_id").val();referralCode&&(data.agentCode=referralCode);var otp=$active.find("#agent_otp").val();otp&&(data.otp=otp),data.chequeNo=$active.find("#cheque_number").val(),data.bankName=$active.find("#bank_name").val(),data.mode="CHEQUE"}else if("5"==type){var referralCode=$active.find("#agent_id").val();referralCode&&(data.agentCode=referralCode),data.bankName=$active.find("#bank_name").val(),data.mode="ONLINE"}var planId=$("#checkout-page-plan").data("planid");data.planId=planId;var txnid=$("#checkout_details").data("txnid");data.txnId=txnid;var message=$active.find("#user_message").val();return message&&(data.message?data.message=data.message+"\n"+message:data.message=message),data}function setupPaymentInfoSumbit(){var isInterestedPage=$("#checkout_details").length;if(isInterestedPage){var postData=function(pdata){var success=function(data){"0"==data.errorCode?($("#submit-payment-generic-error-msg").removeClass("hide").html("Submitted Successfully"),setTimeout(function(){window.location="/user/profile"},5e3)):$("#submit-payment-generic-error-msg").removeClass("hide").html("Error in submitting information. Please contact support for more details")},fail=function(data){$("#submit-payment-generic-error-msg").removeClass("hide").html("Error In Submitting")},urlVars=Utils.getUrlVars();urlVars.contentId&&"null"!=urlVars.contentId&&"undefined"!=urlVars.contentId&&(pdata.contentId=urlVars.contentId),urlVars.userId&&"null"!=urlVars.userId&&"undefined"!=urlVars.userId&&(pdata.userId=urlVars.userId),Utils.showLoader(5e3),Hocalwire.Services.post("/xhr/admin/user/submitPaymentInfo",pdata).then(function(data){Utils.hideLoader(),success(data)},function(data){Utils.hideLoader(),fail(data)})};$(".js_submit_payment_info_btn").on("click",function(){var $active=$(".tab-pane.active"),type=$active.data("type");if("1"==type);else if("2"==type){var data=getpaymentData();postData(data)}else if("3"==type){var data=getpaymentData();if(!data.agentCode&&!data.otp)return void $("#submit-payment-generic-error-msg").removeClass("hide").html("Please enter valid referral id and recepit no (received on agents mombile no)");postData(data),$active.find(".submit_agent_code").removeClass("hide")}else if("4"==type){var data=getpaymentData(),noValidate=$("#no-check-validation");if(!noValidate.length&&!data.agentCode&&!data.otp)return void $("#submit-payment-generic-error-msg").removeClass("hide").html("Please enter valid referral id and recepit no (received on agents mombile no)");postData(data),$active.find(".submit_agent_code").removeClass("hide")}else if("5"==type){var data=getpaymentData();postData(data)}}),$(".js_submit_apply_coupon").on("click",function(){var $active=$(".apply_coupons_wrapper");$active.find(".val_couponCode").val();Utils.showLoader(5e3);var $active=$(".tab-pane.active"),type=$active.data("type");if("1"==type);else if("2"==type){var data=getpaymentData();postData(data)}else if("3"==type){var data=getpaymentData();if(!data.agentCode&&!data.otp)return void $("#submit-payment-generic-error-msg").removeClass("hide").html("Please enter valid referral id and recepit no (received on agents mombile no)");postData(data),$active.find(".submit_agent_code").removeClass("hide")}else if("4"==type){var data=getpaymentData(),noValidate=$("#no-check-validation");if(!noValidate.length&&!data.agentCode&&!data.otp)return void $("#submit-payment-generic-error-msg").removeClass("hide").html("Please enter valid referral id and recepit no (received on agents mombile no)");postData(data),$active.find(".submit_agent_code").removeClass("hide")}else if("5"==type){var data=getpaymentData();postData(data)}}),$(".js_send_agent_code").on("click",function(){var $active=$(".tab-pane.active"),code=($active.data("type"),$active.find("#agent_id").val()),planId=$("#checkout-page-plan").data("planid");if(!code)return void $active.$(".error_agent_code").removeClass("hide");var txnid=$("#checkout_details").data("txnid"),url="/xhr/admin/user/submit-agent-code?code="+code+"&txnid="+txnid+"&planId="+planId;Utils.showLoader(5e3),Hocalwire.Services.get(url).then(function(data){if(Utils.hideLoader(),0==data.errorCode){var dd={};data.data&&(dd=JSON.parse(data.data));var name=dd.nickName||dd.firstName||"",phone=dd.phoneNo||"";name&&$active.find("#agent_name_on_checkout").html(name),phone&&$active.find("#agent_mobile_on_checkout").html(phone),$active.find(".otp_for_agent_message").removeClass("hide")}else $active.find(".otp_for_agent_message").html("Error occured. Try Again").removeClass("hide")},function(e){$(".otp_for_agent_message.hide").html("Error occured. Try Again").removeClass("hide")})}),$(".js_validate_coupon").on("click",function(){var code=$("#coupon_code").val(),planId=$("#checkout-page-plan").data("planid");if(!code)return void $active.$(".error_coupon_empty_code").html("Code Empty").removeClass("hide");var txnid=$("#checkout_details").data("txnid"),url="/xhr/admin/user/submit-coupon-code?code="+code+"&txnid="+txnid+"&planId="+planId;Utils.showLoader(5e3),Hocalwire.Services.get(url).then(function(data){if(Utils.hideLoader(),0==data.errorCode){var dd={};data.data&&(dd=JSON.parse(data.data)),console.log(dd),applyCouponCode(dd)}else $("#coupon_code").attr("is-validated",!1),$(".error_coupon_empty_code").html("Error occured. Try Again").removeClass("hide")},function(e){$("#coupon_code").attr("is-validated",!1),$(".error_coupon_empty_code").html("Error occured. Try Again").removeClass("hide")})})}}function applyCouponCode(data){console.log("apply coupon called");var isValid=data.is_valid;if("true"==isValid){$("#coupon_code").attr("is-validated",!0);var discount=parseInt(data.discount),curr=$("#total_payable_amount"),currVal=parseInt(curr.html()),finalVal=currVal-discount;$("#total_payable_amount").html(finalVal);var message="<b>Congratulations !!! </b><br>You have got a discount of Rs. "+discount+". You discounted value is Rs. "+finalVal;$(".discount_message").html(message).removeClass("hide")}else $(".discount_message").html("Unable to apply your coupon. Your Coupon Code is not valid or expired. Feel free to contact us if you think otherwise.").removeClass("hide")}function setupCheckoutPage(){if($("#checkoutpage").length){var planId=$("#checkoutpage").attr("data-planid");if(planId){var products=getAllProducts(),sendData={},urlVars=Utils.getUrlVars();for(var k in urlVars)sendData[k]=urlVars[k];sendData.items=JSON.stringify(products),sendData.planId=planId;var success=function(data){$("#cart-items").html(data.viewData),setupPaymentInfoSumbit(),bindForProceedToPayment()},fail=function(data){$("#cart-items").html("<div> error in loading</div>")};Utils.showLoader(5e3),Hocalwire.Services.post("/xhr/admin/user/getCartCheckoutPageData",sendData).then(function(data){Utils.hideLoader(),success(data)},function(data){Utils.hideLoader(),fail(data)})}}}function checkoutCart(products,totalPrice,totalQuantity){for(var sendData={},itemIds="",i=0;i<products.length;i++)itemIds+=i<products.length-1?products[i].id+",":products[i].id;sendData.itemIds=itemIds,sendData.planId=planId;var url="/user/checkout?planId="+planId,urlVars=Utils.getUrlVars();for(var k in urlVars)url.indexOf(k)<0&&(url=url+"&"+k+"="+urlVars[k]);window.location.href=url}function bindForProceedToPayment(){var btn=$(".js_checkout_button");btn&&btn.length&&btn.on("click",function(){var url=btn.data("payment-url"),form=$(".checkout-form"),agentId=$(".tab-pane.active #agent_id").val();agentId&&form.find(".agent-code").val(agentId);var couponId=$("#coupon_code").val();couponId&&$("#coupon_code").attr("is-validated")&&form.find(".coupon-code").val(couponId);var options={contentType:"application/x-www-form-urlencoded; charset=utf-8"};Hocalwire.Services.post(url,form.serialize(),options).then(function(data){console.log(data)},function(e){$(".error-msg").removeClass("hide")})})}var planId,partner,userId,initalized=!1;window.initialiseScriptsBinding1=function(){initalized||(initalized=!0,partner=$("#content").attr("data-partner"),userId=$("#content").attr("data-userid"),userId&&"undefined"!=userId||(userId="0"),localStorage.products=localStorage.products?localStorage.products:{},setupCart(),setupCheckoutPage(),profilePageBinding())},window.initScriptArray=window.initScriptArray||[],window.initScriptArray.push(window.initialiseScriptsBinding1);var getAllProducts=function(){try{var products=JSON.parse(localStorage.products);return userId&&products[partner]&&products[partner][userId]?products[partner][userId]:[]}catch(e){return[]}}}();